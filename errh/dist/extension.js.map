{"version":3,"file":"extension.js","mappings":"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","sources":["webpack://errorhandlergenerator/external commonjs \"vscode\"","webpack://errorhandlergenerator/webpack/bootstrap","webpack://errorhandlergenerator/./src/extension.ts"],"sourcesContent":["module.exports = require(\"vscode\");","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","import * as vscode from 'vscode';\n\nconst regexFuncLine = /func\\s*\\([^)]*\\).*/;\nconst regexErrorLine = /\\w+,\\s+\\w+\\s+:=\\s+.*\\)/\nconst regexFuncName = /\\)\\s*\\w+\\s*\\(/\nconst regexReturnParams = /(?:[\\w+,*\\[\\],\\.](?:,\\s*)?)+\\s*\\)\\s*\\{|(?:[\\w+,*\\[\\],\\.](?:,\\s*)?)+\\s*\\{/\n\nexport function activate(context: vscode.ExtensionContext) {\n\tlet disposable = vscode.commands.registerCommand('errorhandlergenerator.errh', () => {\n\t\tconst editor = vscode.window.activeTextEditor;\n\n\t\tconst reciverName = getErrorHandler();\n\n\t\teditor?.insertSnippet(new vscode.SnippetString(reciverName));\n\t});\n\n\tcontext.subscriptions.push(disposable);\n}\n\nexport function deactivate() {}\n\nfunction getErrorHandler(): string {\n\tconst errorLine = getMatchLine(regexErrorLine);\n\tconst funcLine = getMatchLine(regexFuncLine);\n\n\tconst reciverName = getReciverName(funcLine);\n\tconst gloabalFuncName = getGlobalFuncName(funcLine);\n\n\tconst errName = getErrorName(errorLine);\n\tconst localFuncName = getLocalFunctionName(errorLine);\n\n\tconst returnParamsCount = getReturnParamsCount(funcLine);\n\n\tconst packageName = getPackageNameByReciverName(reciverName);\n\n\tlet errorHandler = 'if ' + errName + ' != nil {\\n\\t' + reciverName + '.logger.Error().Err(' + errName + ').Msg(\"error ' + packageName + ' ' + gloabalFuncName + '.' + localFuncName + '\")\\n';\n\n\tswitch (reciverName) {\n\t\tcase 's':\n\t\t\tif (errName == 'errApp') {\n\t\t\t\terrorHandler += '\\tapi_utils.ErrorResponse(cgin, s.ErrorHandler(' + errName + '))\\n';\n\t\t\t}\n\t\t\telse {\n\t\t\t\terrorHandler += '\\tapi_utils.ErrorResponse(cgin, ' + errName + ')\\n';\n\t\t\t}\n\t\t\terrorHandler += '\\treturn\\n';\n\t\t\tbreak;\n\t\tcase 'a' || 'm':\n\t\t\terrorHandler += '\\treturn '\n\t\t\tlet paramsCountApp = returnParamsCount;\n\n\t\t\tif (paramsCountApp == 0) {\n\t\t\t\terrorHandler += '\\n'\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\twhile (paramsCountApp > 0) {\n\t\t\t\terrorHandler += 'nil, ';\n\t\t\t\tparamsCountApp--;\n\t\t\t}\n\n\t\t\tif (errName == 'errRepo') {\n\t\t\t\terrorHandler += errName + ' // need to handle'\n\t\t\t} else if (errName != 'err') {\n\t\t\t\terrorHandler += errName\n\t\t\t}\n\n\t\t\terrorHandler += '\\n';\n\n\t\t\tbreak;\n\t\tcase 'r':\n\t\t\terrorHandler += '\\treturn '\n\t\t\tlet paramsCountRepo = returnParamsCount;\n\t\t\t\n\t\t\tif (paramsCountRepo == 0) {\n\t\t\t\terrorHandler += '\\n'\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\twhile (paramsCountRepo > 0) {\n\t\t\t\terrorHandler += 'nil, ';\n\t\t\t\tparamsCountRepo--;\n\t\t\t}\n\n\t\t\terrorHandler += 'r.ErrorHandler(' + errName + ')\\n';\n\t\t\tbreak;\n\t}\n\n\terrorHandler += '}';\n\n\treturn errorHandler;\n}\n\nfunction getMatchLine(regex: RegExp): string {\n\tconst editor = vscode.window.activeTextEditor;\n\n\tif (editor) {\n\t\tconst position = editor.selection.active;\n\t\tconst currentLine = position.line;\n\t\tlet lineIndex = currentLine;\n\n\t\twhile (lineIndex >= 0) {\n\t\t\tconst line = editor.document.lineAt(lineIndex);\n\t\t\tconst lineText = line.text;\n\t\t\tconst match = regex.exec(lineText);\n\n\t\t\tconsole.log(match);\n\t\t\tif (match && match.length >= 1) {\n\t\t\t\treturn match[0];\n\t\t\t}\n\n\t\t\tlineIndex--;\n\t\t}\n\t}\n\n\treturn '';\n}\n\nfunction getReciverName(line: string): string {\n\tconst splitedLine = line.split('(');\n\tlet reciver = splitedLine[1];\n\treciver = reciver.trim();\n\tconst splitReciver = reciver.split(' ');\n\tconst reciverName = splitReciver[0];\n\n\treturn reciverName;\n}\n\nfunction getErrorName(line : string) : string {\n\tlet splitedLine = line.split('=');\n\tlet errName = '';\n\n\tif (splitedLine.length == 0) {\n\t\treturn '';\n\t}\n\n\tsplitedLine = splitedLine[0].split(',');\n\tif (splitedLine.length == 0) {\n\t\treturn '';\n\t}\n\n\terrName = splitedLine[splitedLine.length - 1];\n\tif (errName != '' && errName[errName.length - 1] == ':') {\n\t\terrName = errName.slice(0, -1).trim();\n\t}\n\n\treturn errName;\n}\n\n// func (s *server) test() error {}\n// func(s *server) test() error {}\n// func(s *server)test() error {}\nfunction getGlobalFuncName(line: string): string {\n\tconst match = regexFuncName.exec(line);\n\tlet funcName = ''\n\n\tif (match && match.length > 0) {\n\t\tfuncName = match[0]\n\t\tfuncName = funcName.slice(1, -1);\n\t\tfuncName = funcName.trim();\n\t}\n\n\n\treturn funcName;\n}\n\nfunction getLocalFunctionName(line: string): string {\n\tlet splitedLine = line.split('=')//[1].trim().split('.');\n\tif (splitedLine.length < 2) {\n\t\treturn ''\n\t}\n\n\tlet funcNames = splitedLine[1].trim();\n\tlet splitFuncNames = funcNames.split('.')\n\n\tlet funcName = splitFuncNames[splitFuncNames.length - 1].trim();\n\tfuncName = funcName.split('(')[0].trim()\n\n\treturn funcName;\n}\n\nfunction getReturnParamsCount(line: string): number {\n\tconst match = regexReturnParams.exec(line);\n\n\tif (match) {\n\t\treturn match[0].split(',').length - 1;\n\t}\n\n\treturn 0\n}\n\nfunction getPackageNameByReciverName(reciverName: string): string {\n\tswitch (reciverName) {\n\t\tcase 's':\n\t\t\treturn 'api';\n\t\tcase 'a':\n\t\t\treturn 'app';\n\t\tcase 'r':\n\t\t\treturn 'repo';\n\t\tdefault:\n\t\t\treturn 'unknown';\n\t}\n}\n\n//TODO:\n// arr, err := test().\n//\tSelect().\n//\tToSql()\n// в таком примере в лог пишется функция test(), должно ToSql()\n\n// если  в сервисной ручке, вызываемая функция является сервисной, то просто возвращаем ошибку\n// если не сервисная делаем обработку\n\n// вероятно, если в функции будет анонимная функция, то все обработка ошибок ниже анонимной функции не сработают корректно\n\n// если на репо уровне один возвращаемый параметр, то в ретурн она не обрабатывается"],"names":["module","exports","require","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","undefined","__webpack_modules__","regexFuncLine","regexErrorLine","regexFuncName","regexReturnParams","getMatchLine","regex","editor","vscode","window","activeTextEditor","lineIndex","selection","active","line","lineText","document","lineAt","text","match","exec","console","log","length","context","disposable","commands","registerCommand","reciverName","errorLine","funcLine","reciver","split","trim","getReciverName","gloabalFuncName","funcName","slice","getGlobalFuncName","errName","splitedLine","getErrorName","localFuncName","splitFuncNames","getLocalFunctionName","returnParamsCount","getReturnParamsCount","packageName","getPackageNameByReciverName","errorHandler","paramsCountApp","paramsCountRepo","getErrorHandler","insertSnippet","SnippetString","subscriptions","push"],"sourceRoot":""}